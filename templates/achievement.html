{% extends "base.html" %}
{% block title %}Achievements{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='achievement.css') }}">


    <div class="container">
        <div class="achievements-header">
            <h1 class="achievements-title">üèÜ Achievements</h1>
            <p class="achievements-subtitle">Track your progress and unlock rewards!</p>
            
            <div class="achievement-stats">
                <div class="stat-item">
                    <span class="stat-number">{{ user_achievements|length }}</span>
                    <span class="stat-label">Unlocked</span>
                </div>
                <div class="stat-divider">/</div>
                <div class="stat-item">
                    <span class="stat-number">{{ all_achievements|length }}</span>
                    <span class="stat-label">Total</span>
                </div>
                <div class="progress-bar">
                </div>
            </div>
        </div>

        <!-- Check Achievements Button -->
        <div class="check-section">
            <form method="POST" action="{{ url_for('check_achievements') }}">
                <button type="submit" class="btn-check-achievements">
                    <span class="check-icon">üîç</span>
                    Check New Achievements
                </button>
            </form>
        </div>

        <!-- Achievements Grid -->
        <div class="achievements-section">
            <div class="achievements-grid">
                {% for achievement in all_achievements %}
                    {% set is_unlocked = achievement.id in user_achievement_ids %}
                    <div class="achievement-card {% if not is_unlocked %}locked{% endif %} difficulty-{{ achievement.difficulty.lower() }}" 
                         data-difficulty="{{ achievement.difficulty.lower() }}" 
                         data-status="{% if is_unlocked %}unlocked{% else %}locked{% endif %}">
                        
                        <!-- Achievement Icon -->
                        <div class="achievement-icon">
                            {% if is_unlocked %}
                                <span class="trophy-icon">üèÜ</span>
                            {% else %}
                                <span class="locked-icon">üîí</span>
                            {% endif %}
                        </div>
                        
                        <!-- Achievement Content -->
                        <div class="achievement-content">
                            <div class="achievement-name">
                                {% if is_unlocked %}
                                    {{ achievement.name }}
                                {% else %}
                                    <span class="hidden-text">???</span>
                                {% endif %}
                            </div>
                            
                            <div class="achievement-description">
                                {% if is_unlocked %}
                                    {{ achievement.description }}
                                {% else %}
                                    <span class="hidden-description">Complete this achievement to unlock!</span>
                                {% endif %}
                            </div>
                            
                            <div class="achievement-condition">
                                {% if is_unlocked %}
                                    <span class="condition-text">{{ achievement.condition }}</span>
                                {% else %}
                                    <span class="hidden-condition">{{ achievement.condition }}</span>
                                {% endif %}
                            </div>
                            
                            <div class="achievement-difficulty difficulty-{{ achievement.difficulty.lower() }}">
                                {{ achievement.difficulty }}
                            </div>
                        </div>
                        
                        <!-- Completion Status -->
                        <div class="achievement-status">
                            {% if is_unlocked %}
                                <span class="status-completed">‚úì Completed</span>
                            {% else %}
                                <span class="status-locked">Locked</span>
                            {% endif %}
                        </div>
                        
                        <!-- Unlock Animation Overlay -->
                        {% if is_unlocked %}
                            <div class="unlock-glow"></div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            
            <!-- Empty State -->
            {% if not all_achievements %}
                <div class="empty-state">
                    <div class="empty-icon">üèÜ</div>
                    <h3>No Achievements Yet</h3>
                    <p>Achievements will appear here as they're added to the game!</p>
                </div>
            {% endif %}

    <!-- Achievement Unlock Notification -->
    <div id="achievement-notification" class="achievement-notification">
        <div class="notification-content">
            <div class="notification-icon">üèÜ</div>
            <div class="notification-text">
                <div class="notification-title">Achievement Unlocked!</div>
                <div class="notification-name" id="unlocked-name"></div>
            </div>
            <button class="notification-close" onclick="closeNotification()">√ó</button>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        {{ message }}
                        <button class="flash-close" onclick="this.parentElement.style.display='none'">√ó</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
{% endblock %}

<script>
function closeNotification() {
    // Option A: If the button is directly inside the notification
    event.target.parentElement.style.display = 'none';
       function filterAchievements(filter) {
            const cards = document.querySelectorAll('.achievement-card');
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            // Update active filter button
            filterBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide achievement cards
            cards.forEach(card => {
                let show = true;
                
                if (filter === 'unlocked') {
                    show = card.dataset.status === 'unlocked';
                } else if (filter === 'locked') {
                    show = card.dataset.status === 'locked';
                } else if (filter !== 'all') {
                    show = card.dataset.difficulty === filter;
                }
                
                card.style.display = show ? 'block' : 'none';
            });
        }
        
        function showAchievementNotification(name) {
            document.getElementById('unlocked-name').textContent = name;
            document.getElementById('achievement-notification').classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                closeNotification();
            }, 5000);
        }
    }
</script>